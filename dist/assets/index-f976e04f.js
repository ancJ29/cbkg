import{W as s,X as C,Y as m,Z as L,_ as W,z as e,$ as S,a0 as V,a1 as y,a2 as J,a3 as D,a4 as h,a5 as l,a6 as Q,a7 as w,a8 as X,G as v,a9 as B,w as M,aa as Y,E as Z,y as G,r as $,t as i}from"./index-db117989.js";import{P as K}from"./index-1b7222f8.js";import{T as H,A as ee}from"./index-00ddd9cb.js";import{T as re}from"./index-83819ef0.js";import{u as z}from"./useTranslation-d9fa93c2.js";import{u as te}from"./use-form-b89b14d2.js";import{C as ae,B as ne}from"./Card-23a5932e.js";import{S as se,F as oe}from"./Stack-0cc441d2.js";import{G as ie}from"./Group-29bf32ec.js";import{C as ce}from"./Checkbox-e6b24ad8.js";import{A as ue}from"./Anchor-f3fc5d99.js";import"./ActionIcon-397f6903.js";import"./Title-cb60633e.js";import"./CheckIcon-ad231d07.js";function F(r){const a=r||!0;return t=>typeof t=="string"?t.trim().length>0?null:a:Array.isArray(t)?t.length>0?null:a:t==null||t===!1?a:null}const u={only:[s.ADMIN]},f={public:!0},P={guestOnly:!0},j={only:[s.ADMIN,s.OWNER,s.CHAIN_MANAGER]},N={only:[s.ADMIN,s.OWNER]},U={except:[s.STAFF]},b={only:[s.ADMIN,s.OWNER,s.MANAGER,s.CHAIN_MANAGER,s.STAFF]},me=C({userName:m(),password:m()}),g=C({cursor:m().optional(),take:L().min(1).max(100).optional().default(20)}),_=C({id:m()}),d=C({cursor:m()}),p=C({success:W()}),I=L().or(m()).transform(r=>new Date(r)),k=I.refine(r=>r.getTime()>Date.now()),T=m().email(),x=m().regex(/^(84\d{9}|842\d{10})$/),O={email:T.optional(),phone:x},le={login:{group:"Authentications",roleConfig:P,schema:{request:me,response:e.object({token:e.string()})}},"get-chains":{group:"Branch management",roleConfig:f,schema:{request:g,response:d.extend({chains:S.extend({totalBranches:e.number()}).array()})}},"add-chain":{group:"Branch management",roleConfig:N,schema:{request:S.pick({name:!0}).required(),response:_}},"update-chain":{group:"Branch management",roleConfig:N,schema:{request:S.pick({id:!0,name:!0}).required()}},"delete-chain":{group:"Branch management",roleConfig:N,schema:{request:e.object({id:e.string()})}},"get-branches":{group:"Branch management",roleConfig:f,schema:{request:g.extend({chainId:e.string().optional(),name:e.string().optional()}),response:d.extend({branches:V.array()})}},"add-branch":{group:"Branch management",roleConfig:j,schema:{request:e.object({chainId:e.string(),name:e.string(),address:e.string(),shortName:e.string()}).extend({email:T,phone:x}),response:_}},"update-branch":{group:"Branch management",roleConfig:j,schema:{request:e.object({id:e.string(),name:e.string(),address:e.string(),shortname:e.string()}).extend({email:T,phone:x})}},"delete-branch":{group:"Branch management",roleConfig:j,schema:{request:e.object({id:e.string()})}},"get-tables":{group:"Branch management",roleConfig:f,schema:{request:g.extend({branchId:e.string()}),response:d.extend({tables:y.array()})}},"add-tables":{group:"Branch management",roleConfig:u,schema:{request:e.object({branchId:e.string(),tables:e.array(y.pick({name:!0}).required())}),response:p}},"update-table":{group:"Branch management",roleConfig:u,schema:{request:y.pick({id:!0,name:!0}).required()}},"delete-table":{group:"Branch management",roleConfig:u,schema:{request:y.pick({id:!0}).required()}},"get-messages":{group:"Message template",roleConfig:u,schema:{request:g.extend({from:e.string().optional(),templateId:e.string().optional()}),response:d.extend({messages:J.array()})}},"get-all-message-templates":{group:"Message template",roleConfig:u,schema:{request:e.object({}),response:D.array()}},"add-message-template":{group:"Message template",roleConfig:u,schema:{request:D.pick({name:!0,code:!0,description:!0,template:!0,type:!0}).extend({config:e.record(e.string(),e.string())}),response:p}},"disable-message-template":{group:"Message template",roleConfig:u,schema:{request:e.object({code:e.string()}),response:p}},"enable-message-template":{group:"Message template",roleConfig:u,schema:{request:e.object({code:e.string()}),response:p}},"get-reservations":{group:"Reservation",roleConfig:f,schema:{request:g.extend({name:e.string().optional(),phone:e.string().optional(),branchIds:e.string().array().optional(),statuses:e.nativeEnum(h).array().optional(),from:I.optional(),to:I.optional()}),response:d.extend({reservations:l.array()})}},"add-reservation":{group:"Reservation",roleConfig:b,schema:{request:l.pick({branchId:!0,contact:!0,note:!0}).extend({phone:x,from:k.describe("from must be greater than current time"),adults:e.number().positive(),children:e.number().positive().optional(),status:e.nativeEnum(h).refine(r=>r!==h.CANCELLED).describe("Except Cancelled Status")}),response:p}},"add-reservation-by-end-user":{group:"Reservation",roleConfig:P,schema:{request:l.pick({branchId:!0,contact:!0,note:!0}).extend({phone:x,from:k.describe("from must be greater than current time"),adults:e.number().positive(),children:e.number().positive().optional()}),response:e.object({code:e.string()})}},"update-reservation":{group:"Reservation",roleConfig:b,schema:{request:l.pick({branchId:!0,contact:!0,note:!0,code:!0}).extend({from:k.describe("from must be greater than current time"),phone:e.string().regex(/^(84\d{9}|842\d{10})$/),adults:e.number().positive(),children:e.number().positive().optional(),status:e.nativeEnum(h).refine(r=>r!==h.CANCELLED).describe("Except Cancelled Status")})}},"confirm-reservation":{group:"Reservation",roleConfig:{only:[s.MANAGER,s.STAFF]},schema:{request:l.pick({code:!0,contact:!0,note:!0}).extend({tableId:e.string().optional()})}},"confirm-reservation-by-code":{group:"Reservation",roleConfig:f,schema:{request:l.pick({code:!0,contact:!0,note:!0}).extend({reservationCode:e.string()})}},"cancel-reservation":{group:"Reservation",roleConfig:{only:[s.MANAGER,s.STAFF]},schema:{request:l.pick({code:!0,contact:!0}).extend({note:e.string()})}},"get-users":{group:"User management",roleConfig:{except:[s.STAFF]},schema:{request:g.extend({name:e.string().optional(),chainId:e.string().optional(),branchId:e.string().optional()}),response:d.extend({users:Q.pick({id:!0,userName:!0,fullName:!0,role:!0,active:!0,createdAt:!0,updatedAt:!0,chainIds:!0,branchIds:!0}).array()})}},"change-password":{group:"User management",roleConfig:u,schema:{request:e.object({id:e.string(),password:e.string()}),response:p}},"disable-users":{group:"User management",roleConfig:u,schema:{request:e.object({ids:e.array(e.string())}),response:p}},"add-user":{group:"User management",roleConfig:U,schema:{request:e.object({userName:e.string(),fullName:e.string(),password:e.string(),role:e.nativeEnum(s),branchIds:e.string().array().optional(),chainIds:e.string().array().optional()}),response:e.object({id:e.string(),userName:e.string(),fullName:e.string(),role:e.nativeEnum(s).nullable()})}},"edit-user":{group:"User management",roleConfig:U,schema:{request:e.object({id:e.string(),userName:e.string().optional(),fullName:e.string().optional(),role:e.nativeEnum(s).optional(),branchIds:e.string().array().optional(),chainIds:e.string().array().optional()})}},"get-customers":{group:"Customer management",roleConfig:b,schema:{request:g,response:d.extend({customers:w.array()})}},"add-customer":{group:"Customer management",roleConfig:b,schema:{request:w.pick({name:!0,address:!0}).extend(O),response:w}},"edit-customer":{group:"Customer management",roleConfig:b,schema:{request:w.pick({id:!0,name:!0,address:!0}).extend(O)}}},ge="http://localhost:9200/req";let A=0;const q=new X({max:100,maxSize:1e3,sizeCalculation:()=>1,ttl:1e3*60});function de(r,a){return a}async function pe({params:r,action:a,options:t={}}){const n=de(a,r);let c="";if(!(t!=null&&t.noCache)&&a.startsWith("get-")){const o=be(a,n,t==null?void 0:t.forceReload);if(c=o.key,o.data)return v.debug("[api-v2-cache-hit]",c,a,n),o.data}!(t!=null&&t.noLoading)&&Ce();const E=Date.now();try{const o=await ye(a,n);return t!=null&&t.showToastMessage&&B(t.toastMessage||"Successfully"),c&&q.set(c,o),v.debug("[api-v2-success]",c,a,r,o),o}catch(o){t!=null&&t.showToastMessage&&B("Unknown error"),v.error("[api-v2-error]",o)}finally{xe(E)}}function he(r,a){const n=Date.now();return btoa(`${n-n%6e4}.${r}.${JSON.stringify(a||{})}`)}function fe(r){if(q.has(r))return q.get(r)}function be(r,a,t){const n=he(r,a);if(v.debug("[api-v2-cache]",n,{action:r,params:a}),t)return q.delete(n),{key:n};const c=fe(n);return c?{key:n,data:c}:{key:n}}async function xe(r){const t=Math.max(800-(Date.now()-r),0);t>0&&await new Promise(n=>setTimeout(n,t)),A--,A<1&&window.dispatchEvent(new Event("clear-loading"))}async function Ce(){A<1&&window.dispatchEvent(new Event("start-loading")),A++}async function ye(r,a){const t=M.getState().token;return(await Y({method:"POST",url:ge,data:{action:r,params:R(a)},headers:{"Content-Type":"application/json",Authorization:t?`Bearer ${t}`:void 0,"x-unix-timestamp":"true"}})).data}function R(r){if(Z.isDayjs(r))return r.unix()*1e3;if(r instanceof Date)return r.getTime();if(typeof r=="string"){const a=new Date(r);return a.toString()!=="Invalid Date"?a.getTime():r}else return Array.isArray(r)?r.map(R):typeof r=="object"&&r!==null?Object.fromEntries(Object.entries(r).map(([a,t])=>[a,R(t)])):r}le.login.schema.request.extend({remember:e.boolean().optional()});const we=()=>{const r=z(),a=G(),{setToken:t}=M(),n=te({initialValues:{userName:"",password:"",remember:!1},validate:{userName:F(r("Please enter Email")),password:F(r("Please enter Password"))},transformValues:Ae}),c=$.useCallback(async E=>{const o=await pe({params:E,action:"login"});o!=null&&o.token?(t(o.token,n.values.remember),a("/dashboard")):n.setErrors({password:r("Username or password is incorrect.")})},[n,a,t,r]);return i.jsx(ae,{withBorder:!0,shadow:"md",radius:10,mt:"1rem",children:i.jsx(se,{gap:"xs",p:".5rem",pt:0,children:i.jsxs("form",{onSubmit:n.onSubmit(c),children:[i.jsx(re,{withAsterisk:!0,pb:".8rem",label:r("Username"),placeholder:r("Enter Username"),...n.getInputProps("userName")}),i.jsx(K,{withAsterisk:!0,label:r("Password"),placeholder:r("Enter Password"),...n.getInputProps("password")}),i.jsxs(ie,{justify:"flex-start",mt:"xl",children:[i.jsxs(oe,{w:"100%",fz:"0.8rem",justify:"space-between",children:[i.jsx(ce,{...n.getInputProps("remember"),label:r("Remember me")}),i.jsx(ue,{href:"/forgot-password",underline:"never",children:i.jsxs(H,{children:[r("Forgot your password"),"?"]})})]}),i.jsx(ne,{type:"submit",w:"100%",children:r("Sign in")})]})]})})})},ve=we;function Ae(r){return{userName:r.userName.toString().trim(),password:r.password.toString().trim()}}function Ue(){const r=z(),a=G(),{user:t}=M();return $.useEffect(()=>{t&&a("/dashboard")},[a,t]),i.jsxs(ee,{children:[i.jsxs(H,{children:[r("Sign in to continue to C-Booking"),"."]}),i.jsx(ve,{})]})}export{Ue as default};
